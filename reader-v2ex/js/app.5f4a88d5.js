(function(e){function t(t){for(var i,r,a=t[0],l=t[1],c=t[2],d=0,m=[];d<a.length;d++)r=a[d],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&m.push(o[r][0]),o[r]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);u&&u(t);while(m.length)m.shift()();return n.push.apply(n,c||[]),s()}function s(){for(var e,t=0;t<n.length;t++){for(var s=n[t],i=!0,a=1;a<s.length;a++){var l=s[a];0!==o[l]&&(i=!1)}i&&(n.splice(t--,1),e=r(r.s=s[0]))}return e}var i={},o={app:0},n=[];function r(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=i,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(s,i,function(t){return e[t]}.bind(null,i));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/reader-v2ex/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],l=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var u=l;n.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"01aa":function(e,t,s){},"02d0":function(e,t,s){},"0420":function(e,t,s){},"07e9":function(e,t,s){},"089a":function(e,t,s){e.exports=s.p+"fonts/element-icons.535877f5.woff"},"0c82":function(e,t,s){},"0ca3":function(e,t,s){},"0d7e":function(e,t,s){},"0dcb":function(e,t,s){},1056:function(e,t,s){"use strict";s("dd69")},"15f5":function(e,t,s){e.exports=s.p+"img/logined.687bce67.svg"},1771:function(e,t,s){var i={"./an-login.svg":"1dca","./element-ui/alert.css":"8068","./element-ui/aside.css":"25e6","./element-ui/autocomplete.css":"6dcb","./element-ui/avatar.css":"5467","./element-ui/backtop.css":"3cf0","./element-ui/badge.css":"62a1","./element-ui/base.css":"0420","./element-ui/breadcrumb-item.css":"832e","./element-ui/breadcrumb.css":"60c7","./element-ui/button-group.css":"5e35","./element-ui/button.css":"6658","./element-ui/calendar.css":"7d55","./element-ui/card.css":"2b58","./element-ui/carousel-item.css":"c44a","./element-ui/carousel.css":"bdcb","./element-ui/cascader-panel.css":"d570","./element-ui/cascader.css":"77f3","./element-ui/checkbox-button.css":"9340","./element-ui/checkbox-group.css":"c3e4","./element-ui/checkbox.css":"b6da","./element-ui/col.css":"db47","./element-ui/collapse-item.css":"8fde","./element-ui/collapse.css":"07e9","./element-ui/color-picker.css":"435e","./element-ui/container.css":"eb9d","./element-ui/date-picker.css":"aee7","./element-ui/descriptions-item.css":"2c80","./element-ui/descriptions.css":"950b","./element-ui/dialog.css":"77f4","./element-ui/display.css":"282e","./element-ui/divider.css":"60d0","./element-ui/drawer.css":"d107","./element-ui/dropdown-item.css":"b6e7","./element-ui/dropdown-menu.css":"7e48","./element-ui/dropdown.css":"64d8","./element-ui/empty.css":"01aa","./element-ui/fonts/element-icons.ttf":"33df","./element-ui/fonts/element-icons.woff":"089a","./element-ui/footer.css":"3154","./element-ui/form-item.css":"c5fd","./element-ui/form.css":"715c","./element-ui/header.css":"0c82","./element-ui/icon.css":"7d56","./element-ui/image.css":"ef25","./element-ui/index.css":"0d7e","./element-ui/infinite-scroll.css":"8441","./element-ui/infiniteScroll.css":"b932","./element-ui/input-number.css":"91f2","./element-ui/input.css":"6939","./element-ui/link.css":"d7fd","./element-ui/loading.css":"fd06","./element-ui/main.css":"4ba7","./element-ui/menu-item-group.css":"dc0d","./element-ui/menu-item.css":"b9f4","./element-ui/menu.css":"daf0","./element-ui/message-box.css":"6b83","./element-ui/message.css":"cd45","./element-ui/notification.css":"8f76","./element-ui/option-group.css":"0dcb","./element-ui/option.css":"25a0","./element-ui/page-header.css":"3020","./element-ui/pagination.css":"0ca3","./element-ui/popconfirm.css":"a14b","./element-ui/popover.css":"eff5","./element-ui/popper.css":"b95a","./element-ui/progress.css":"20d0","./element-ui/radio-button.css":"3e93","./element-ui/radio-group.css":"2bd1","./element-ui/radio.css":"c87f","./element-ui/rate.css":"63bd","./element-ui/reset.css":"973c","./element-ui/result.css":"4118","./element-ui/row.css":"76ff","./element-ui/scrollbar.css":"b983","./element-ui/select-dropdown.css":"8df7","./element-ui/select.css":"304d","./element-ui/skeleton-item.css":"9362","./element-ui/skeleton.css":"2116","./element-ui/slider.css":"ee53","./element-ui/spinner.css":"824c","./element-ui/step.css":"1ce8","./element-ui/steps.css":"fce6","./element-ui/submenu.css":"2e74","./element-ui/switch.css":"9872","./element-ui/tab-pane.css":"947b","./element-ui/table-column.css":"a21c","./element-ui/table.css":"ed38","./element-ui/tabs.css":"c648","./element-ui/tag.css":"c22a","./element-ui/time-picker.css":"c214","./element-ui/time-select.css":"2318","./element-ui/timeline-item.css":"90d2","./element-ui/timeline.css":"7aad","./element-ui/tooltip.css":"d159","./element-ui/transfer.css":"a452","./element-ui/tree.css":"f29b","./element-ui/upload.css":"68dc","./logined.svg":"15f5","./logo.png":"cf05","./my-style.css":"b8b1","./un-login.svg":"a1af","./v2ex-logo.png":"4209"};function o(e){var t=n(e);return s(t)}function n(e){if(!s.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}o.keys=function(){return Object.keys(i)},o.resolve=n,e.exports=o,o.id="1771"},"1ce8":function(e,t,s){},"1dca":function(e,t,s){e.exports=s.p+"img/an-login.fce77a4b.svg"},"20d0":function(e,t,s){},2116:function(e,t,s){},2318:function(e,t,s){},"25a0":function(e,t,s){},"25e6":function(e,t,s){},"282e":function(e,t,s){},"2b58":function(e,t,s){},"2bd1":function(e,t,s){},"2c80":function(e,t,s){},"2c97":function(e,t,s){},"2e74":function(e,t,s){},3020:function(e,t,s){},"304d":function(e,t,s){},3154:function(e,t,s){},"33df":function(e,t,s){e.exports=s.p+"fonts/element-icons.732389de.ttf"},"3cf0":function(e,t,s){},"3e93":function(e,t,s){},4118:function(e,t,s){},4209:function(e,t,s){e.exports=s.p+"img/v2ex-logo.20e10b38.png"},"435e":function(e,t,s){},"4ba7":function(e,t,s){},5354:function(e,t,s){},5467:function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);s("0fae");var i=s("9e2f"),o=s.n(i),n=s("2b0e"),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("el-row",{attrs:{type:"flex",justify:"space-around"}},[t("el-col",{attrs:{xs:24,sm:20,md:16,lg:12}},[t("keep-alive",{attrs:{exclude:"Document"}},[t("router-view")],1)],1)],1)],1)},a=[],l={name:"App"},c=l,u=(s("b6ca"),s("2877")),d=Object(u["a"])(c,r,a,!1,null,null,null),m=d.exports,f=s("d148"),h=(s("14d9"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"inedx"},[t("div",{staticClass:"flex justify-between items-center"},[e._m(0),t("div",[t("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-user"},on:{click:function(t){return e.$router.push({path:"/cloud"})}}},[e._v("账户")])],1)]),t("div",{staticClass:"cursor-pointer mb-8 flex justify-center items-center bg-gray-100 hover:bg-gray-200 p-8",on:{click:function(t){return e.$router.push({path:"document",query:{url:"https://v2ex.com"}})}}},[t("div",{staticClass:"mr-2 bold"},[e._v("open")]),t("img",{staticClass:"w-40",attrs:{src:s("4209"),alt:"logo"}})]),e.historys.length?t("el-card",{staticClass:"historys",attrs:{shadow:"never"}},[t("div",{staticClass:"not-importent historys-header",attrs:{slot:"header"},slot:"header"},[t("div",[t("span",[e._v("历史记录")])]),t("div",[t("el-button",{staticClass:"el-icon-delete",attrs:{type:"text"},on:{click:e.clearHistorys}})],1)]),e._l(e.historys,(function(s,i){return t("div",{key:s.time,staticClass:"history"},[i?t("el-divider"):e._e(),t("div",{staticClass:"history-inner"},[t("div",[t("el-link",{on:{click:function(t){return e.openHistoryDocument(s)}}},[e._v(e._s(s.title))])],1)])],1)}))],2):e._e()],1)}),p=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"logo"},[t("img",{attrs:{src:s("cf05"),alt:"logo"}})])}],g={name:"Index",data(){return{url:"",historys:[]}},activated(){const e=JSON.parse(localStorage.getItem("documentHistory")||"[]");this.historys=e.slice(0,100).map(e=>(e.star=!!e.star,e))},computed:{allHistory(){return this.staredHistorys.concat(this.historys)}},methods:{search(e,t){e&&this.$router.push({path:"/document",query:{url:e,source:t}})},openHistoryDocument(e){this.$router.push({path:"/document",query:{url:e.url}})},switchHistoryStar(e){e.star=!e.star,e.time=Date.now(),localStorage.setItem("documentHistory",JSON.stringify(this.historys))},clearHistorys(){this.historys=this.historys.filter(e=>e.star),localStorage.setItem("documentHistory",JSON.stringify(this.historys))},clickMore(e){this.search(this.url,e)}}},y=g,b=(s("c470"),Object(u["a"])(y,h,p,!1,null,"028b68dd",null)),v=b.exports,w=function(){var e=this,t=e._self._c;return e.document?t("div",{staticClass:"document"},[t("el-page-header",{attrs:{content:e.document.title,title:"首页"},on:{back:function(t){return e.$router.push("/")}}}),t("div",{class:e.showShareCard?"opacity-10":0},e._l(e.document.list,(function(s){return t("div",{key:s.insideId,staticClass:"content"},["text"==s.type?t("p",[s.ref?t("el-link",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push({query:{url:s.ref}})}}},[e._v(e._s(s.content))]):t("span",[e._v(e._s(s.content))])],1):"img"==s.type?t("p",[t("el-image",{staticClass:"w-32 h-32",attrs:{src:s.content,"preview-src-list":e.imgSrcList}})],1):"video"==s.type?t("p",[t("video",{attrs:{src:s.content,controls:""}})]):t("p",[t("span",[e._v("[未知类型]"+e._s(s.content))])])])})),0),t("div",{staticClass:"fixed bottom-1 right-1 z-10"},[t("div",{ref:"shareCardDemo",staticClass:"p-4 border-gray-300 w-80 hidden",style:{backgroundColor:e.shareCard.bgColor}},[t("h2",{staticClass:"text-lg text-center text-black font-bold mb-2"},[e._v(e._s(e.document.title))]),e._l(e.shareCard.imgs,(function(s){return t("div",{key:s,staticClass:"mt-4 max-w-80"},[t("el-image",{staticClass:"w-full",attrs:{src:s},on:{click:function(t){return e.useImgInShardCard(s)}}})],1)})),e._l(e.shareCardSelectedItems,(function(s){return t("p",{key:s.insideId,staticClass:"py-1 break-all"},[e._v(" "+e._s(s.content)+" ")])})),t("p",{staticClass:"py-1 break-all"},[e._v("...")]),t("div",{staticClass:"flex items-center mt-2 justify-between"},[t("div",{staticClass:"text-xs"},[e._v("识别二维码浏览全文")]),t("div",[t("img",{ref:"qrcode",staticClass:"block w-16 h-16",attrs:{src:"",alt:""}})])])],2),t("div",{directives:[{name:"show",rawName:"v-show",value:e.showShareCard,expression:"showShareCard"}],ref:"shareCard",staticClass:"p-2"},[t("img",{ref:"shareCardImg",staticClass:"w-80",attrs:{src:"",alt:""}}),t("div",{staticClass:"text-xs text-gray-500 text-center bg-white pt-2 w-80"},[t("div",[e._v(" ps:长按此卡片可保存或分享 ")]),t("div",{staticClass:"ctrl-card mt-2"},[e.shareCardImgs.length?t("div",{staticClass:"w-80 overflow-auto flex gap-2"},e._l(e.shareCardImgs,(function(s){return t("div",{key:s},[t("el-image",{staticClass:"w-16 h-16 cursor-pointer",attrs:{src:s,fit:"cover"},on:{click:function(t){return e.useImgInShardCard(s)}}})],1)})),0):e._e(),t("div",{staticClass:"flex items-center justify-center mt-2 w-80"},[t("div",{staticClass:"mr-2 flex"},[t("el-color-picker",{attrs:{"show-alpha":"",predefine:e.shareCard.predefineColors},model:{value:e.shareCard.bgColor,callback:function(t){e.$set(e.shareCard,"bgColor",t)},expression:"shareCard.bgColor"}})],1),t("el-select",{attrs:{multiple:"","popper-class":"w-80","multiple-limit":3,"popper-append-to-body":!1,placeholder:"请选择"},model:{value:e.shareCard.checkList,callback:function(t){e.$set(e.shareCard,"checkList",t)},expression:"shareCard.checkList"}},e._l(e.shareCardItems,(function(e){return t("el-option",{key:e.insideId,attrs:{label:e.content,value:e.insideId}})})),1)],1)]),t("div",{staticClass:"py-2"},[t("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-download"},on:{click:e.downloadShareCard}},[e._v("保存")]),t("el-button",{attrs:{type:"default",size:"small",icon:"el-icon-close"},on:{click:e.cancleShare}},[e._v("取消")]),t("el-button",{attrs:{type:"default",size:"small",icon:"el-icon-refresh"},on:{click:e.shareByCard}},[e._v("重绘")])],1)])]),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.showShareCard,expression:"!showShareCard"}],staticClass:"p-2"},[t("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-share"},on:{click:e.shareByCard}},[e._v("分享")]),t("el-button",{attrs:{type:"default",size:"small",icon:"el-icon-star-off"},on:{click:e.addUserCollect}},[e._v("收藏")]),t("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-user"},on:{click:function(t){return e.$router.push({path:"/cloud"})}}},[e._v("账户")])],1)]),t("div",{staticClass:"not-importent host-tip"},[t("el-link",{attrs:{href:e.document.url,target:"_blank",type:"info"}},[e._v("内容由"+e._s(e.urlHost)+"提供")])],1)],1):e._e()},C=[],x=(s("3c65"),s("d055")),_=s.n(x),k=s("c0e9"),S=s.n(k),$={name:"Document",props:{url:{type:String,required:!0},source:{type:String}},data(){return{document:null,cachedDocuments:{},showShareCard:!1,shareCard:{bgColor:"rgba(255, 69, 0, 0.68)",checkList:[],imgs:[],predefineColors:["#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgba(255, 69, 0, 0.68)","rgb(255, 120, 0)","hsv(51, 100, 98)","hsva(120, 40, 94, 0.5)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#c7158577"]}}},computed:{urlHost:function(){if(!this.document)return"";var e=/^https?:\/\/(.+?)(?:(?:\/)|$)/i.exec(this.document.url);return e[1]||this.document.url},imgSrcList:function(){return this.document?this.document.list.filter(e=>"img"==e.type).map(e=>e.content):[]},shareCardImgs(){return this.imgSrcList.slice(0,30)},shareCardItems(){return this.document?this.document.list.slice(0,20):[]},shareCardSelectedItems(){return this.document?this.document.list.filter(e=>this.shareCard.checkList.includes(e.insideId)):[]}},watch:{url:function(e){if(e){const t=this.cachedDocuments[e];t?(this.document=t,this.pushHistory(),scrollTo(0,0)):this.loadDocument()}},document(e){e&&(window.document.title=e.title)},"shareCard.bgColor":"shareByCard","shareCard.checkList":{deep:!0,handler:"shareByCard"},"shareCard.imgs":{deep:!0,handler(){const e=this.$loading();setTimeout(()=>{e.close(),this.shareByCard()},1e3)}}},created(){this.loadDocument()},methods:{useImgInShardCard(e){const t=this.shareCard.imgs.indexOf(e);t>=0?this.shareCard.imgs.splice(t,1):this.shareCard.imgs=[e]},downloadShareCard(){var e=document.createElement("a");e.download="share.png",e.href=this.$refs.shareCardImg.src,document.body.appendChild(e),e.click(),e.remove(),this.cancleShare()},cancleShare(){this.showShareCard=!1},async shareByCard(){const e=await _.a.toDataURL(this.document.url,{color:{light:"#ffffff00"}});console.log(e),this.$refs.qrcode.src=e,this.$refs.shareCardDemo.style.display="block";const t=this.shareCardCanvas=await S()(this.$refs.shareCardDemo,{allowTaint:!0,useCORS:!0,imageTimeout:3e4});this.$refs.shareCardDemo.style.display="none",this.$refs.shareCardImg.src=t.toDataURL("image/png"),this.showShareCard=!0},async loadDocument(){const e=this.$loading();console.log("加载："+this.url);try{const t=await fetch(`https://service-ifv9sp1e-1252108641.sg.apigw.tencentcs.com/release/load-document?url=${this.url}&source=${this.source}`),s=await t.json();console.log(s),this.document=this.cachedDocuments[this.url]=s,e.close(),this.pushHistory(),scrollTo(0,0)}catch(t){this.$message.error(t.message)}finally{e.close()}},pushHistory(){let e=JSON.parse(localStorage.getItem("documentHistory")||"[]");const t={title:this.document.title,url:this.document.url,time:Date.now()};e=e.filter(e=>e.star||e.url!=t.url),e.unshift(t),localStorage.setItem("documentHistory",JSON.stringify(e))},async addUserCollect(){if(this.cloudAuth.hasLoginState()){const e=await fetch("https://service-o4amteg7-1252108641.sh.apigw.tencentcs.com/release/tcb-dba",{method:"POST",body:JSON.stringify({action:"ty-add-reader-user-collect",data:{openid:this.cloudAuth.currentUser.uid,url:this.document.url,title:this.document.title}})}).then(e=>e.json());e.res.code?(console.log(e.res),this.$message.error("操作失败，请稍后重试")):this.$message.success("已收藏")}else this.$message.warning("需登录")}}},F=$,L=(s("c89d"),Object(u["a"])(F,w,C,!1,null,"4da0ea48",null)),D=L.exports,P=function(){var e=this,t=e._self._c;return t("div",{staticClass:"hello-world"},[t("el-page-header",{attrs:{content:"账户"},on:{back:function(t){return e.$router.back()}}}),t("div",{staticClass:"user"},[t("div",{staticClass:"user-icon flex justify-center"},[t("img",{attrs:{src:s("1771")("./"+e.userIcon),alt:"头像"}})]),t("div",{staticClass:"user-name"},[e._v(e._s(e.userName))])]),t("div",{staticClass:"actions"},[t("div",{staticClass:"action"},[e.user.logined&&0!=e.user.loginType?e._e():t("el-button",{attrs:{type:"primary"},on:{click:function(t){e.loginForm.email=e.user.email,e.showLoginDialog=!0}}},[e._v(e._s(e.loginText))])],1),t("div",{staticClass:"action"},[e.user.logined&&0==e.user.loginType&&!e.user.email?t("el-button",{attrs:{type:"info"},on:{click:function(t){e.showSetEmailDialog=!0}}},[e._v("绑定邮箱")]):e._e()],1),t("div",{staticClass:"action"},[e.user.logined?e._e():t("el-button",{attrs:{type:"text",loading:e.loginLoading},on:{click:e.loginAsAnonymous}},[e._v("匿名登录")])],1),t("div",{staticClass:"action"},[e.user.logined?e._e():t("el-button",{attrs:{type:"success"},on:{click:function(t){e.showRegisterDialog=!0}}},[e._v("注册")])],1),t("div",{staticClass:"action"},[e.user.logined?t("el-popconfirm",{attrs:{title:"确定退出登录吗？"},on:{confirm:e.logout}},[t("el-button",{attrs:{slot:"reference",type:"danger",loading:e.logoutLoading},slot:"reference"},[e._v("退出")])],1):e._e()],1)]),e.user.logined?t("div",{key:e.userName},[t("UserCollect")],1):e._e(),t("el-dialog",{attrs:{title:"登录",visible:e.showLoginDialog,width:"350px"},on:{"update:visible":function(t){e.showLoginDialog=t}}},[t("el-form",{ref:"loginForm",attrs:{model:e.loginForm,rules:e.loginRules,"label-width":"60px"}},[t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{attrs:{placeholder:"邮箱","prefix-icon":"el-icon-user"},model:{value:e.loginForm.email,callback:function(t){e.$set(e.loginForm,"email","string"===typeof t?t.trim():t)},expression:"loginForm.email"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{placeholder:"密码","prefix-icon":"el-icon-key","show-password":""},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password","string"===typeof t?t.trim():t)},expression:"loginForm.password"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.loginLoading},on:{click:e.login}},[e._v(" 登录 ")]),t("el-button",{attrs:{type:"text"},on:{click:e.forgetPassword}},[e._v("忘记密码")])],1)],1)],1),t("el-dialog",{attrs:{title:"绑定邮箱",visible:e.showSetEmailDialog,width:"350px"},on:{"update:visible":function(t){e.showSetEmailDialog=t}}},[t("el-form",{ref:"setEmailForm",attrs:{model:e.setEmailForm,rules:e.setEmailRules,"label-width":"60px"}},[t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{attrs:{placeholder:"邮箱","prefix-icon":"el-icon-user"},model:{value:e.setEmailForm.email,callback:function(t){e.$set(e.setEmailForm,"email","string"===typeof t?t.trim():t)},expression:"setEmailForm.email"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{placeholder:"密码","prefix-icon":"el-icon-key","show-password":""},model:{value:e.setEmailForm.password,callback:function(t){e.$set(e.setEmailForm,"password","string"===typeof t?t.trim():t)},expression:"setEmailForm.password"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.setEmailLoading},on:{click:e.setEmail}},[e._v(" 确定 ")])],1)],1)],1),t("el-dialog",{attrs:{title:"注册",visible:e.showRegisterDialog,width:"350px"},on:{"update:visible":function(t){e.showRegisterDialog=t}}},[t("el-form",{ref:"registerForm",attrs:{model:e.registerForm,rules:e.registerRules,"label-width":"60px"}},[t("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[t("el-input",{attrs:{placeholder:"邮箱","prefix-icon":"el-icon-user"},model:{value:e.registerForm.email,callback:function(t){e.$set(e.registerForm,"email","string"===typeof t?t.trim():t)},expression:"registerForm.email"}})],1),t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{placeholder:"密码","prefix-icon":"el-icon-key","show-password":""},model:{value:e.registerForm.password,callback:function(t){e.$set(e.registerForm,"password","string"===typeof t?t.trim():t)},expression:"registerForm.password"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"success",loading:e.registerLoading},on:{click:e.register}},[e._v(" 确定 ")])],1)],1)],1),t("el-dialog",{attrs:{title:"重置密码",visible:e.showResetPasswordDialog,width:"350px"},on:{"update:visible":function(t){e.showResetPasswordDialog=t}}},[t("el-form",{ref:"resetPasswordForm",attrs:{model:e.resetPasswordForm,rules:e.resetPasswordRules,"label-width":"60px"}},[t("el-form-item",{attrs:{label:"邮箱",prop:" "}},[t("el-input",{attrs:{placeholder:"邮箱","prefix-icon":"el-icon-user"},model:{value:e.resetPasswordForm.email,callback:function(t){e.$set(e.resetPasswordForm,"email","string"===typeof t?t.trim():t)},expression:"resetPasswordForm.email"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.resetPasswordLoading},on:{click:e.resetPassword}},[e._v(" 确定 ")])],1)],1)],1)],1)},O=[],E=function(){var e=this,t=e._self._c;return t("div",{staticClass:"user-collect"},[t("el-card",{staticClass:"collects",attrs:{shadow:"never"}},[t("div",{staticClass:"not-importent collects-header",attrs:{slot:"header"},slot:"header"},[t("div",[t("span",[e._v("我的收藏"),t("i",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"el-icon-loading"})])])]),e._l(e.collects,(function(s,i){return t("div",{key:s.time,staticClass:"collect"},[i?t("el-divider"):e._e(),t("div",{staticClass:"flex justify-between"},[t("div",{staticClass:"mr-4"},[t("el-link",{on:{click:function(t){return e.$router.push({path:"/document",query:{url:s.url}})}}},[e._v(e._s(s.title))])],1),t("el-popconfirm",{attrs:{title:"确定删除吗？"},on:{confirm:function(t){return e.removeCollect(s)}}},[t("el-button",{staticClass:"collect-delete",attrs:{slot:"reference",type:"text",icon:"el-icon-delete"},slot:"reference"},[e._v(" 删除 ")])],1)],1)],1)}))],2)],1)},I=[],j={data(){return{collects:[],loading:!1}},async created(){this.loading=!0;try{const e=await fetch("https://service-o4amteg7-1252108641.sh.apigw.tencentcs.com/release/tcb-dba",{method:"POST",body:JSON.stringify({action:"ty-query-reader-user-collect",data:{openid:this.cloudAuth.currentUser.uid}})}).then(e=>e.json());this.collects=e}catch(e){console.log(e)}finally{this.loading=!1}},methods:{async removeCollect(e){const t=await fetch("https://service-o4amteg7-1252108641.sh.apigw.tencentcs.com/release/tcb-dba",{method:"POST",body:JSON.stringify({action:"ty-remove-reader-user-collect",data:{openid:this.cloudAuth.currentUser.uid,collectId:e._id}})}).then(e=>e.json());console.log(t),t.code?this.$message.error("操作失败，请稍后重试"):this.collects=this.collects.filter(e=>e._id!=e._id)}}},A=j,R=Object(u["a"])(A,E,I,!1,null,null,null),T=R.exports,U={name:"EoCloud",props:{msg:String},components:{UserCollect:T},data(){return{user:{email:"",logined:!1,loginType:""},showLoginDialog:!1,loginForm:{email:"",password:""},loginRules:{email:[{required:!0,trigger:"blur"}],password:[{required:!0,trigger:"blur"}]},loginLoading:!1,logoutLoading:!1,showSetEmailDialog:!1,setEmailForm:{email:"",password:""},setEmailRules:{email:[{required:!0,trigger:"blur"}],password:[{required:!0,trigger:"blur"}]},setEmailLoading:!1,showRegisterDialog:!1,registerForm:{email:"",password:""},registerRules:{email:[{required:!0,trigger:"blur"}],password:[{required:!0,trigger:"blur"}]},registerLoading:!1,showResetPasswordDialog:!1,resetPasswordForm:{email:""},resetPasswordRules:{email:[{required:!0,trigger:"blur"}]},resetPasswordLoading:!1}},computed:{userIcon(){return this.user.logined?"0"==this.user.loginType?"an-login.svg":"logined.svg":"un-login.svg"},userName(){return this.user.logined?"0"==this.user.loginType?"匿名用户":this.user.email:"未登录"},loginText(){return(this.user.email?"使用"+this.user.email:"邮箱")+"登录"}},created(){this.cloudAuth.onLoginStateChanged(e=>{console.log(e,this.cloudAuth.currentUser),this.cloudAuth.getLoginState().then(console.log),e?(this.user.logined=!0,this.user.loginType="ANONYMOUS"==e.loginType?"0":"1",this.user.email=e.user.email):this.user.logined=!1})},methods:{async login(){this.loginLoading=!0;try{await this.$refs.loginForm.validate(),await this.cloudAuth.signInWithEmailAndPassword(this.loginForm.email,this.loginForm.password),this.showLoginDialog=!1,this.$notify({message:"登录成功",type:"success"})}catch(e){this.$notify({message:e.message||"请检查表单",type:"error"})}finally{this.loginLoading=!1}},async logout(){this.logoutLoading=!0;try{this.cloudAuth.signOut()}catch(e){this.$notify({message:e.message,type:"error"})}finally{this.logoutLoading=!1}},async loginAsAnonymous(){this.loginLoading=!0;try{const e=await this.cloudAuth.anonymousAuthProvider().signIn();console.log(e),this.showLoginDialog=!1}catch(e){this.$notify({message:e.message,type:"error"})}finally{this.loginLoading=!1}},async setEmail(){this.setEmailLoading=!0;try{await this.cloudAuth.currentUser.updateUsername(this.cloudAuth.currentUser.uid),await this.cloudAuth.currentUser.updatePassword(this.setEmailForm.password),await this.cloudAuth.currentUser.updateEmail(this.setEmailForm.email),this.showSetEmailDialog=!1,this.$notify({message:"验证邮件已发送，请检查邮箱以激活",type:"success"})}catch(e){this.$notify({message:e.message,type:"error"})}finally{this.setEmailLoading=!1}},async register(){this.registerLoading=!0;try{await this.cloudAuth.signUpWithEmailAndPassword(this.registerForm.email,this.registerForm.password),this.showRegisterDialog=!1,this.$notify({message:"验证邮件已发送，请检查邮箱以激活",type:"success"})}catch(e){this.$notify({message:e.message,type:"error"})}finally{this.registerLoading=!1}},forgetPassword(){this.resetPasswordForm.email=this.loginForm.email,this.showResetPasswordDialog=!0},async resetPassword(){this.resetPasswordLoading=!0;try{await this.cloudAuth.sendPasswordResetEmail(this.resetPasswordForm.email),this.showResetPasswordDialog=!1,this.$notify({message:"验证邮件已发送，请检查邮箱以激活",type:"success"})}catch(e){this.$notify({message:e.message,type:"error"})}finally{this.resetPasswordLoading=!1}}}},N=U,q=(s("1056"),Object(u["a"])(N,P,O,!1,null,"5c058fd2",null)),H=q.exports,J=s("8c4f");s("b972"),s("0d7e"),s("b8b1");const z=n["default"].prototype.cloud=f["a"].init({env:"dev-9g0suwuw61afb9f3"});n["default"].prototype.cloudAuth=z.auth({persistence:"local"}),n["default"].use(J["a"]),n["default"].use(o.a),n["default"].config.productionTip=!1;const M=[{path:"/",component:v},{path:"/index",component:v},{path:"/document",component:D,props:e=>({...e.query})},{path:"/cloud",component:H,props:!0}],B=new J["a"]({routes:M});new n["default"]({render:e=>e(m),router:B}).$mount("#app")},"5e35":function(e,t,s){},"60c7":function(e,t,s){},"60d0":function(e,t,s){},"62a1":function(e,t,s){},"63bd":function(e,t,s){},"64d8":function(e,t,s){},6658:function(e,t,s){},"68dc":function(e,t,s){},6939:function(e,t,s){},"6b83":function(e,t,s){},"6dcb":function(e,t,s){},"715c":function(e,t,s){},"76ff":function(e,t,s){},"77f3":function(e,t,s){},"77f4":function(e,t,s){},"7aad":function(e,t,s){},"7d55":function(e,t,s){},"7d56":function(e,t,s){},"7e48":function(e,t,s){},8068:function(e,t,s){},"824c":function(e,t,s){},"832e":function(e,t,s){},8441:function(e,t,s){},"8df7":function(e,t,s){},"8f76":function(e,t,s){},"8fde":function(e,t,s){},"90d2":function(e,t,s){},"91f2":function(e,t,s){},9340:function(e,t,s){},9362:function(e,t,s){},"947b":function(e,t,s){},"950b":function(e,t,s){},"973c":function(e,t,s){},9872:function(e,t,s){},a14b:function(e,t,s){},a1af:function(e,t,s){e.exports=s.p+"img/un-login.fe221741.svg"},a21c:function(e,t,s){},a452:function(e,t,s){},aee7:function(e,t,s){},b6ca:function(e,t,s){"use strict";s("2c97")},b6da:function(e,t,s){},b6e7:function(e,t,s){},b8b1:function(e,t,s){},b932:function(e,t,s){},b95a:function(e,t,s){},b983:function(e,t,s){},b9f4:function(e,t,s){},bdcb:function(e,t,s){},c214:function(e,t,s){},c22a:function(e,t,s){},c3e4:function(e,t,s){},c44a:function(e,t,s){},c470:function(e,t,s){"use strict";s("02d0")},c5fd:function(e,t,s){},c648:function(e,t,s){},c87f:function(e,t,s){},c89d:function(e,t,s){"use strict";s("5354")},cd45:function(e,t,s){},cf05:function(e,t,s){e.exports=s.p+"img/logo.863ee97c.png"},d107:function(e,t,s){},d159:function(e,t,s){},d570:function(e,t,s){},d7fd:function(e,t,s){},daf0:function(e,t,s){},db47:function(e,t,s){},dc0d:function(e,t,s){},dd69:function(e,t,s){},eb9d:function(e,t,s){},ed38:function(e,t,s){},ee53:function(e,t,s){},ef25:function(e,t,s){},eff5:function(e,t,s){},f29b:function(e,t,s){},fce6:function(e,t,s){},fd06:function(e,t,s){}});
//# sourceMappingURL=app.5f4a88d5.js.map